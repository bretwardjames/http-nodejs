<style>
    @media (max-width: 768px) {
        select {
            white-space: normal;
        }

        select[multiple] {
            height: auto;
            white-space: normal;
        }
    }

    .form-control {
        height: 60px;
        font-size: 20px;
    }

    .checkbox-button {
        display: block;
        width: 100%;
        white-space: normal;
        word-wrap: break-word;
        text-align: left;
        padding: 10px;
        font-size: 20px;
        background-color: #F1F4F8;
        color: black;
        cursor: pointer;
        user-select: none;
        transition: background-color 0.3s, color 0.3s;
    }

    .checkbox-button.checked {
        background-color: #428bca;
        border: 2px solid #357ebd;
        border-radius: 4px;
        color: white;
    }

    .checkbox-button input[type="checkbox"] {
        display: none;
    }

    #button-container-describesyou .btn {
        display: block;
        width: 100%;
        white-space: normal;
        word-wrap: break-word;
        text-align: left;
        padding: 10px;
        font-size: 20px;
    }

    #button-container .btn {
        display: block;
        width: 100%;
        white-space: normal;
        word-wrap: break-word;
        text-align: left;
        padding: 10px;
        font-size: 20px;
    }

    .button-container .btn {
        white-space: normal;
        word-wrap: break-word;
        text-align: left;
        padding: 10px;
        font-size: 20px;
    }

    .button-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        /* Add some gap between the buttons */
    }

    .button-container .btn-sm {
        display: inline-block;
        /* Ensure buttons are inline */
        width: auto;
        /* Ensure buttons are responsive to content */
        flex: 1 1 auto;
        /* Allow buttons to grow and shrink as needed */
        margin: 5px;
        /* Add margin to ensure space between buttons */
    }

    .form-range {
        width: 100%;
        margin: 10px 0;
    }

    .range-label,
    .range-value {
        font-size: 20px;
        /* Increase the font size */
        font-weight: bold;
        /* Make the text bold */
    }

    .infusion-field-input-container {
        display: flex;
        flex-direction: column;
        gap: 10px;
        /* Adjust the gap between buttons */
    }
</style>
<div class="progress mb-4">
    <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0"
        aria-valuemax="100"><span id="progress"></span> complete</div>
</div>
<form accept-charset="UTF-8" class="infusion-form" id="dynamic_form">
    <div class="form-group">
        <div class="infusion-field">
            <label for="inf_field_FirstName" class="d-block mb-2 h3">First Name *</label>
            <input class="form-control form-control-lg" id="inf_field_FirstName" name="inf_field_FirstName"
                placeholder="First Name *" type="text" required="required">
        </div>
        <div class="infusion-field" style="display: none;">
            <label for="inf_field_LastName" class="d-block mb-2 h3">Last Name *</label>
            <input class="form-control form-control-lg" id="inf_field_LastName" name="inf_field_LastName"
                placeholder="Last Name *" type="text">
        </div>
        <div class="infusion-field" style="display: none;">
            <label for="inf_field_Email" class="d-block mb-2 h3">Email *</label>
            <input class="form-control form-control-lg" id="inf_field_Email" name="inf_field_Email"
                placeholder="Email *" type="email">
        </div>
        <div class="infusion-field" style="display: none;">
            <label for="inf_field_Phone1" class="d-block mb-2 h3">Phone Number *</label>
            <input class="form-control form-control-lg" id="inf_field_Phone1" name="inf_field_Phone1"
                placeholder="Phone Number *" type="tel" pattern="^\d{7,15}$"
                title="Please enter a valid phone number with 7 to 15 digits">
        </div>
        <div class="infusion-field">
            <label for="entrepreneur_or_no" class="d-block mb-2 h3">Which of the
                following best describes you?</label>
            <select class="form-control form-control-lg" id="entrepreneur_or_no" name="entrepreneur_or_no">
                <option value="">Please select one</option>
                <option
                    value="I'm a business owner or entrepreneur and I am currently in the process of starting, growing or scaling my business.">
                    I'm a business owner or entrepreneur and I am currently in the process of starting, growing or
                    scaling my business.</option>
                <option value="I'm not a business owner and am not actively wanting to start one at this time.">I'm not
                    a business owner and am not actively wanting to start one at this time.</option>
            </select>
        </div>
        <div class="infusion-field" style="display: none;">
            <label for="business_type" class="d-block mb-2 h3">What type of business are you in
                (i.e. relationship coaching, digital marketing agency, accountant, corporate consultant, health
                practitioner, etc)? *</label>
            <input class="form-control form-control-lg" id="business_type" name="business_type"
                placeholder="What type of business are you in (i.e. relationship coaching, digital marketing agency, accountant, corporate consultant, health practitioner, etc)? *"
                type="text">
        </div>
        <div class="infusion-field" style="display: none;">
            <label for="how_long_in_business" class="d-block mb-2 h3">How long have you been
                building this business? *</label>
            <div class="infusion-field-input-container">
                <select class="form-control form-control-lg" id="how_long_in_business" name="how_long_in_business">
                    <option value="">Please select one</option>
                    <option value="I'm still trying to figure out what business I want to start.">I'm still trying
                        to figure out what business I want to start.</option>
                    <option value="I'm clear on my business but haven't actually started yet.">I'm clear on
                        my business but haven't actually started yet.</option>
                    <option value="I've been actively growing my business for less than 6 months.">I've been
                        actively growing my business for less than 6 months.</option>
                    <option value="I've been working on this business for about a year.">I've been working on this
                        business for about a year.</option>
                    <option value="I've been working on this business for about 2 years.">I've been working on
                        this business for about 2 years.</option>
                    <option value="I's been over 2 years that I've been working on this business.">It's been over
                        2 years that I've been working on this business.</option>
                </select>
            </div>
        </div>
        <div class="infusion-field" style="display: none;">
            <label for="areas_for_support" class="d-block mb-2 h3">What areas would you like to have
                support on moving forward? * (select all that apply)</label>
            <div class="infusion-field-input-container">
                <div id="button-container" style="display: flex; flex-direction: column; gap: 10px;"></div>
                <select style="display:none" type="hidden" id="areas_for_support" name="areas_for_support" multiple=''>
                    <option value="Creating powerful differentiated messaging.">Creating powerful differentiated
                        messaging.</option>
                    <option value="Putting together the details of an irresistible offer(s)">Putting together the
                        details of an irresistible offer(s)</option>
                    <option value="Having a clear action plan that I can follow every week">Having a clear action plan
                        that I can follow every week</option>
                    <option value="Consistently getting in front of my ideal client/prospects">Consistently getting in
                        front of my ideal client/prospects</option>
                    <option value="Maintaining an unshakeable mindset so I can make consistent progress">Maintaining an
                        unshakeable mindset so I can make consistent progress</option>
                    <option value="Finding ways to generate more consistent 'now' revenue">Finding ways to
                        generate more consistent 'now' revenue</option>
                    <option value="Taking my already profitable business and scaling to the next level">Taking my
                        already profitable business and scaling to the next level</option>
                    <option value="Further developing my enrollment skills">Further developing my enrollment skills
                    </option>
                    <option value="Knowing what strategy to focus on now or next">Knowing what strategy to focus on now
                        or next</option>
                </select>
            </div>
        </div>
        <div class="infusion-field" style="display: none;">
            <label for="biggest_challenge" class="d-block mb-2 h3">What do you
                believe is the biggest challenge you're facing in your business right now? *</label>
            <textarea class="form-control form-control-lg" cols="24" id="biggest_challenge" name="biggest_challenge"
                placeholder="What do you believe is the biggest challenge you're facing in your business right now? *"
                rows="7"></textarea>
        </div>
        <div class="infusion-field" style="display: none;">
            <label for="ft_pt" class="d-block mb-2 h3">Is this business full time or part time
                for you? *</label>
            <div class="infusion-field-input-container">
                <select class="form-control form-control-lg" id="ft_pt" name="ft_pt">
                    <option value="">Please select one</option>
                    <option value="Full time">Full time</option>
                    <option value="Part Time">Part Time</option>
                </select>
            </div>
        </div>
        <div class="infusion-field" style="display: none;">
            <label for="monthly_rev" class="d-block mb-2 h3">On average,
                how much revenue are you currently making each month in your business? *</label>
            <div class="infusion-field-input-container">
                <select class="form-control form-control-lg" id="monthly_rev" name="monthly_rev">
                    <option value="">Please select one</option>
                    <option value="Not generating any revenue">Not generating any revenue</option>
                    <option value="$0 to $2500/month">$0 to $2500/month</option>
                    <option value="$2500 to $5k/month">$2500 to $5k/month</option>
                    <option value="$5k to $7500/month">$5k to $7500/month</option>
                    <option value="$7500 to $10k/month">$7500 to $10k/month</option>
                    <option value="$10k to $20k/month">$10k to $20k/month</option>
                    <option value="$20k+/month">$20k+/month</option>
                </select>
            </div>
        </div>
        <div class="infusion-field" style="display: none;">
            <label for="income_goal" class="d-block mb-2 h3">What is your NEXT level monthly income
                goal? This may not be your ultimate monthly income goal but will allow you to be free of financial
                insecurity and give you next level abundance. *</label>
            <div class="infusion-field-input-container">
                <select class="form-control form-control-lg" id="income_goal" name="income_goal">
                    <option value="">Please select one</option>
                    <option value="$0 to $5k/month">$0 to $5k/month</option>
                    <option value="$5k to $10k/month">$5k to $10k/month</option>
                    <option value="$10k to $25k/month">$10k to $25k/month</option>
                    <option value="$25k to $50k/month">$25k to $50k/month</option>
                    <option value="$50k to $100k/month">$50k to $100k/month</option>
                    <option value="$100k+ per month">$100k+ per month</option>
                </select>
            </div>
        </div>
        <div class="infusion-field" style="display: none;">
            <label for="household_income" class="d-block mb-2 h3">What was your total household income
                over the last 12 months? *</label>
            <div class="infusion-field-input-container">
                <select class="form-control form-control-lg" id="household_income" name="household_income">
                    <option value="">Please select one</option>
                    <option value="Less than $50k">Less than $50k</option>
                    <option value="$50k to $75k">$50k to $75k</option>
                    <option value="$75k to 100K">$75k to 100K</option>
                    <option value="$100k to $150k">$100k to $150k</option>
                    <option value="$150k to $250k">$150k to $250k</option>
                    <option value="$250k+">$250k+</option>
                </select>
            </div>
        </div>
        <div class="infusion-field" style="display: none;">
            <label for="resources_to_invest" class="d-block mb-2 h3">If you were confident in a solution
                that would help you overcome your current challenges, give you the support you need and help you hit
                your NEXT level monthly income goal in the next 6 to 12 months, what resources do you currently have
                available to invest in that solution? These resources can include your checking, savings, 401k, credit
                lines, credit cards, available loans or other available resources. (Note: this will determine which
                solution and strategies we recommend.) *</label>
            <div class="infusion-field-input-container">
                <select class="form-control form-control-lg" id="resources_to_invest" name="resources_to_invest">
                    <option value="">Please select one</option>
                    <option
                        value="I know I need to invest to grow my business but I'm in a tight spot and don't have any resources available at this time.">
                        I know I need to invest to grow my business but I'm in a tight spot and don't have any resources
                        available at this time.</option>
                    <option value="$500 to $2k">$500 to $2k</option>
                    <option value="$2k to $5k">$2k to $5k</option>
                    <option value="$5k to $10k">$5k to $10k</option>
                    <option value="$10k to $25k">$10k to $25k</option>
                    <option value="$25k to $50k">$25k to $50k</option>
                    <option value="$50k to $100k">$50k to $100k</option>
                    <option value="$100k+">$100k+</option>
                </select>
            </div>
        </div>
        <div class="infusion-field" style="display: none;">
            <label for="other_programs" class="d-block mb-2 h3">Are you currently enrolled in any
                other coaching or training programs? *</label>
            <div class="infusion-field-input-container">
                <select class="form-control form-control-lg" id="other_programs" name="other_programs">
                    <option value="">Please select one</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
            </div>
        </div>
        <div class="infusion-field" style="display: none;">
            <label for="urgency" class="d-block mb-2 h3">On a
                scale from 1-10, how urgent is it for you to find a way to get your business, impact and income to the
                next level? (1 not very urgent it's something that would be nice- 10 very urgent I need to get things to
                the next level now.) *</label>
            <div class="infusion-field-input-container">
                <select class="form-control form-control-lg" id="urgency" name="urgency">
                    <option value="">Please select one</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                </select>
            </div>
        </div>
        <div class="infusion-field" style="display: none;">
            <label for="comitment_level" class="d-block mb-2 h3">On a scale from 1-10, how committed are
                you to investing in support for your next level if you feel it's the right solution (1 not very
                committed I'll do it all on my own - 10 very committed I know mentorship is the best way to do this)?
                *</label>
            <div class="infusion-field-input-container">
                <select class="form-control form-control-lg" id="comitment_level" name="comitment_level">
                    <option value="">Please select one</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                </select>
            </div>
        </div>
        <div class="infusion-field" id="interest_topics">
            <label for="interest_topics" class="d-block mb-2 h3">Awesome! What topics are you interested in? *</label>
            <div class="infusion-field-input-container">
                <div class="checkbox-button" data-value="16018">
                    <input id="inf_option_Howtomakemoremoney" name="inf_option_Howtomakemoremoney" type="checkbox"
                        value="16018" />
                    <label for="inf_option_Howtomakemoremoney">How to make more money</label>
                </div>
                <div class="checkbox-button" data-value="16020">
                    <input id="inf_option_Relationships" name="inf_option_Relationships" type="checkbox"
                        value="16020" />
                    <label for="inf_option_Relationships">Relationships</label>
                </div>
                <div class="checkbox-button" data-value="16022">
                    <input id="inf_option_Health" name="inf_option_Health" type="checkbox" value="16022" />
                    <label for="inf_option_Health">Health</label>
                </div>
                <div class="checkbox-button" data-value="16024">
                    <input id="inf_option_Spirituality" name="inf_option_Spirituality" type="checkbox" value="16024" />
                    <label for="inf_option_Spirituality">Spirituality</label>
                </div>
                <div class="checkbox-button" data-value="16026">
                    <input id="inf_option_LearninghowtofacilitateDavidsframeworksforothers"
                        name="inf_option_LearninghowtofacilitateDavidsframeworksforothers" type="checkbox"
                        value="16026" />
                    <label for="inf_option_LearninghowtofacilitateDavidsframeworksforothers">Learning how to facilitate
                        David's frameworks for others</label>
                </div>
                <div class="checkbox-button" data-value="16028">
                    <input id="inf_option_Parenting" name="inf_option_Parenting" type="checkbox" value="16028" />
                    <label for="inf_option_Parenting">Parenting</label>
                </div>
                <div class="checkbox-button" data-value="16030">
                    <input id="inf_option_EntrepreneurshipStartingabusiness"
                        name="inf_option_EntrepreneurshipStartingabusiness" type="checkbox" value="16030" />
                    <label for="inf_option_EntrepreneurshipStartingabusiness">Entrepreneurship/Starting a
                        business</label>
                </div>
                <div class="checkbox-button" data-value="16032">
                    <input id="inf_option_AttendingDavidsliveevents" name="inf_option_AttendingDavidsliveevents"
                        type="checkbox" value="16032" />
                    <label for="inf_option_AttendingDavidsliveevents">Attending David's live events</label>
                </div>
            </div>
        </div>
        <div id="formNavigation" style="margin-top:10px">
            <button type="button" id="backButton" class="btn btn-secondary" style="display: none;">Back</button>
            <button type="button" id="nextButton" class="btn btn-primary">Next</button>
        </div>
    </div>
</form>
<script type="text/javascript">
    console.log('Form JavaScript executed');
    let contactId
    async function getContactId(email) {
        if (contactId) return contactId
        const data = {
            apiName: "KEAP",
            endpoint: `v1/contacts/?email=${email}`,
            method: 'GET'
        };

        try {
            const response = await fetch('https://http-nodejs-production-5fbc.up.railway.app/proxy', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });

            const result = await response.json();
            console.log('Response:', result);

            if (!result.contacts || result.contacts.length === 0) {
                throw new Error('No contacts found');
            }

            return result.contacts[0].id;
        } catch (error) {
            console.log('Error:', error);
            return null;
        }
    }
    const routingLogic = {
        "inf_field_FirstName": {
            "default": 1,
            "prefillFromUrl": true,
            "prefillParams": [
                "inf_field_FirstName"
            ]
        },
        "inf_field_LastName": {
            "default": 2,
            "prefillFromUrl": true,
            "prefillParams": [
                "inf_field_LastName"
            ]
        },
        "inf_field_Email": {
            "default": 3,
            "prefillFromUrl": true,
            "prefillParams": [
                "inf_field_Email"
            ]
        },
        "inf_field_Phone1": {
            "default": 4,
            "prefillFromUrl": true,
            "prefillParams": [
                "inf_field_Phone1"
            ]
        },
        "business_type": {
            "default": 6
        },
        "how_long_in_business": {
            "default": 7
        },
        "areas_for_support": {
            "default": 8
        },
        "biggest_challenge": {
            "default": 9
        },
        "ft_pt": {
            "default": 10
        },
        "monthly_rev": {
            "default": 11
        },
        "income_goal": {
            "default": 12
        },
        "household_income": {
            "default": 13
        },
        "resources_to_invest": {
            "default": 14
        },
        "other_programs": {
            "default": 15
        },
        "comitment_level": {
            "default": "submit"
        },
        "entrepreneur_or_no": {
            "default": 5,
            "answers": {
                "I'm a business owner or entrepreneur and I am currently in the process of starting, growing or scaling my business.": 5, // Next question
                "I'm not a business owner and am not actively wanting to start one at this time.": 17,
            }
        },
        "urgency": {
            "default": 16
        },
        "interest_topics": {
            "default": 'submit' // or the appropriate next question index after interest topics
        },
    };
    const formElements = Array.from(document.querySelectorAll('.infusion-field'))
    let currentElementIndex = 0;
    let navigationHistory = [];
    formElements.forEach(el => {
        el.isActive = true
        if (el.classList?.contains('noshow')) {
            el.isActive = false
        }
    });
    function showQuestion(index, firstTime = false) {
        formElements.forEach((el, i) => {
            const inputEl = el.querySelector('input, select, textarea');
            if (i === index) {
                el.style.display = '';
                if (inputEl) {
                    inputEl.setAttribute('required', 'required');
                }
            } else {
                el.style.display = 'none';
                if (inputEl) {
                    inputEl.removeAttribute('required');
                }
            }
        });
        document.getElementById('backButton').style.display = index === 0 ? 'none' : 'inline-block';
        document.getElementById('nextButton').textContent = index === formElements.length - 1 ? 'Submit' : 'Next';
        document.getElementById('nextButton').type = index === formElements.length - 1 ? 'submit' : 'button';
        updateProgressBar(first = firstTime);
    }
    function encodeCurlyApostrophe(str) {
        return str // str.replace(/'/g, '&rsquo;');
    }
    function getNextIndex(currentElement) {
        const inputEl = currentElement.querySelector('input, select, textarea');
        const elementName = inputEl ? inputEl.name : null;
        let nextIndex = elementName ? routingLogic[elementName].default : 'submit';
        console.log(routingLogic[elementName])
        if (elementName && routingLogic[elementName].answers) {
            const encodedValue = encodeCurlyApostrophe(inputEl.value);
            if (routingLogic[elementName].answers[encodedValue]) {
                nextIndex = routingLogic[elementName].answers[encodedValue];
            }
        }
        formElements.forEach((el, index) => {
            if (!el.isActive || (index >= currentElementIndex && index < nextIndex) || el.classList?.contains('noshow')) {
                el.isActive = false;
            } else {
                el.isActive = true;
            }
        });
        while (nextIndex !== 'submit' && !formElements[nextIndex].isActive) {
            nextIndex = getNextIndex(formElements[nextIndex]);
        }
        return nextIndex;
    }
    function handleBackButton() {
        if (navigationHistory.length > 0) {
            currentElementIndex = navigationHistory.pop();
            showQuestion(currentElementIndex);
        }
    }
    async function validateCurrentElement(element) {
        const inputEl = element.querySelector('input, select, textarea');
        if (inputEl && inputEl.hasAttribute('required')) {
            if (inputEl.value.trim() === '') {
                return false;
            }
            if (inputEl.type === 'tel' && !/^\d{7,15}$/.test(inputEl.value.trim())) {
                alert('Please enter a valid phone number with 7 to 15 digits.');
                return false;
            } else if (inputEl.type === 'email' && !contactId) {
                contactId = await getContactId(inputEl.value)
            }
        }
        return true;
    }
    function roundToZeroOrWhole(number) {
        return number <= 3 ? 0 : Math.floor(number);
    }
    function updateProgressBar(first = false) {
        const visibleElements = formElements.filter(el => el.isActive);
        const currentIndex = visibleElements.indexOf(formElements[currentElementIndex]);
        if (currentIndex === -1) {
            return;
        }
        const totalQuestions = visibleElements.length;
        const progress = first ? 1 : ((currentIndex + 1) / totalQuestions) * 100;
        const progressBar = document.getElementById('progressBar');
        const progressPercent = document.getElementById('progress');
        progressBar.style.width = `${progress}%`;
        progressPercent.innerText = `${roundToZeroOrWhole(progress)}%`;
        progressBar.setAttribute('aria-valuenow', progress);
    }
    function applyPrefillAndSkip() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('ContactId')) {
            contactId = urlParams.get('ContactId');
        }
        const skipPrequal = urlParams.get('skipPrequal') === 'true';
        formElements.forEach((el, index) => {
            const inputEl = el.querySelector('input, select, textarea');
            const elementName = inputEl ? inputEl.name : null;
            if (skipPrequal && elementName === 'entrepreneur_or_no') {
                el.isActive = false;
                return;
            }
            if (inputEl) {
                if (routingLogic[elementName] && routingLogic[elementName].prefillParams) {
                    const prefillParams = routingLogic[elementName].prefillParams;
                    for (let param of prefillParams) {
                        if (urlParams.has(param) && urlParams.get(param).trim() !== "") {
                            let value = urlParams.get(param);
                            if (elementName === 'inf_field_Phone1') {
                                value = value.replace(/\D/g, ''); // Strip out non-numeric characters
                            }
                            inputEl.value = value;
                            const nextIndex = getNextIndex(el);
                            if (nextIndex !== 'submit') {
                                el.isActive = false;
                                el.style.display = 'none';
                                currentElementIndex = nextIndex;
                            }
                            break;
                        }
                    }
                }
            }
        });
        currentElementIndex = formElements[currentElementIndex].isActive ? currentElementIndex : currentElementIndex + 1;
        showQuestion(currentElementIndex, firstTime = true);
    }
    function handleSubmit() {
        const urlParams = new URLSearchParams(window.location.search);
        let soSkip = false
        formElements.forEach(el => {
            const inputEl = el.querySelector('input, select, textarea');
            let name = inputEl.name
            if (inputEl.name === 'inf_field_FirstName') {
                name = 'Name'
            } else if (inputEl.name === 'inf_field_Email') {
                name = 'Email'
                soSkip = true
            } else if (inputEl.name === 'inf_field_Phone1') {
                name = 'Phone'
            }
            if (inputEl && inputEl.value) {
                const encodedValue = inputEl.value.replace(/\+/g, '%20');
                urlParams.append(name, encodedValue);
            }
        });
        if (soSkip) {
            urlParams.append('soSkip', 1);
        }
        if (contactId) {
            urlParams.append('ContactId', contactId);
        }
        let redirectUrl = 'https://davidbayercoaching.com/ss-survey-results'; // Default thank you page
        // Add your logic to set redirectUrl based on answers here
        console.log(`${redirectUrl}?${urlParams.toString().replace(/\+/g, '%20')}`)
        window.location.href = `${redirectUrl}?${urlParams.toString()}`;
    }
    async function handleNextButton() {
        const currentElement = formElements[currentElementIndex];
        const valid = await validateCurrentElement(currentElement);
        if (!validateCurrentElement(currentElement)) {
            alert('Please fill in the required fields.');
            return;
        }
        const fields = currentElement.querySelectorAll('input[name], textarea[name], select[name]');
        const emailInvalid = Array.from(fields).some(field => {
            if (field.name.toLowerCase().includes('email')) {
                const email = field.value;
                const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!regex.test(email)) {
                    alert('Please enter a valid email address.');
                    return true;
                }
            }
            return false;
        });
        if (emailInvalid) {
            return;
        }
        const nextIndex = getNextIndex(currentElement);
        if (nextIndex === 'submit') {
            handleSubmit();
        } else {
            if (navigationHistory[navigationHistory.length - 1] !== currentElementIndex) {
                navigationHistory.push(currentElementIndex);
            }
            currentElementIndex = nextIndex;
            showQuestion(currentElementIndex);
            console.log(formElements, currentElementIndex, nextIndex)
            if (window.innerWidth <= 768) {
                document.getElementById('progressBar').scrollIntoView({ behavior: 'smooth' });
            }
        }
    }
    document.getElementById('nextButton').addEventListener('click', handleNextButton);
    document.getElementById('backButton').addEventListener('click', handleBackButton);
    document.querySelectorAll('.checkbox-button').forEach(button => {
        button.addEventListener('click', function () {
            const checkbox = this.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            this.classList.toggle('checked', checkbox.checked);
        });
    });
    const options = [
        { display: "Creating powerful differentiated messaging.", value: "Creating powerful differentiated messaging." },
        { display: "Putting together the details of an irresistible offer(s)", value: "Putting together the details of an irresistible offer(s)" },
        { display: "Having a clear action plan that I can follow every week", value: "Having a clear action plan that I can follow every week" },
        { display: "Consistently getting in front of my ideal client/prospects", value: "Consistently getting in front of my ideal client/prospects" },
        { display: "Maintaining an unshakeable mindset so I can make consistent progress", value: "Maintaining an unshakeable mindset so I can make consistent progress" },
        { display: "Finding ways to generate more consistent 'now' revenue", value: "Finding ways to generate more consistent 'now' revenue" },
        { display: "Taking my already profitable business and scaling to the next level", value: "Taking my already profitable business and scaling to the next level" },
        { display: "Further developing my enrollment skills", value: "Further developing my enrollment skills" },
        { display: "Knowing what strategy to focus on now or next", value: "Knowing what strategy to focus on now or next" }
    ];
    const selectedOptions = new Set();
    const buttonContainer = document.getElementById('button-container');
    const hiddenSelect = document.getElementById('areas_for_support');
    options.forEach(option => {
        const button = document.createElement('button');
        button.type = 'button';
        button.className = 'btn btn-outline-primary m-2';
        button.textContent = option.display;
        button.style.width = '100%';
        button.style.whiteSpace = 'normal';
        const isSelected = Array.from(hiddenSelect.options).some(opt => opt.value === option.value && opt.selected);
        if (isSelected) {
            selectedOptions.add(option.value);
            button.classList.remove('btn-outline-primary');
            button.classList.add('btn-primary');
        }
        button.addEventListener('click', function () {
            if (selectedOptions.has(option.value)) {
                selectedOptions.delete(option.value);
                button.classList.remove('btn-primary');
                button.classList.add('btn-outline-primary');
            } else {
                selectedOptions.add(option.value);
                button.classList.remove('btn-outline-primary');
                button.classList.add('btn-primary');
            }
            updateHiddenInput();
        });
        buttonContainer.appendChild(button);
    });
    function updateHiddenInput() {
        const options = hiddenSelect.options;
        for (let i = 0; i < options.length; i++) {
            if (selectedOptions.has(options[i].value)) {
                options[i].selected = true;
            } else {
                options[i].selected = false;
            }
        }
    }
    document.querySelectorAll('#button-container-describesyou .btn').forEach(button => {
        button.addEventListener('click', function () {
            document.querySelectorAll('#button-container-describesyou .btn').forEach(btn => btn.classList.remove('btn-primary'));
            button.classList.add('btn-primary');
            document.getElementById('entrepreneur_or_no').value = button.getAttribute('data-value');
        });
    });
    const selects = document.querySelectorAll('select.form-control');
    selects.forEach(select => {
        const parentDiv = select.parentElement;
        const options = Array.from(select.options);
        const buttonContainer = document.createElement('div');
        buttonContainer.className = 'infusion-field-input-container button-container';
        const isRange = options.every((option, index) => {
            if (index === 0) return true;
            return !isNaN(option.value) && +option.value === index;
        });
        if (isRange && options.length === 11) {
            const sliderLabel = document.createElement('label');
            sliderLabel.textContent = "Select a value:";
            sliderLabel.className = 'range-label';
            const slider = document.createElement('input');
            slider.type = 'range';
            slider.min = 1;
            slider.max = 10;
            slider.value = 1;
            slider.className = 'form-range';
            const sliderValue = document.createElement('span');
            sliderValue.textContent = slider.value;
            sliderValue.className = 'range-value';
            slider.addEventListener('input', function () {
                sliderValue.textContent = slider.value;
                select.value = slider.value;
            });
            buttonContainer.appendChild(sliderLabel);
            buttonContainer.appendChild(slider);
            buttonContainer.appendChild(sliderValue);
        } else {
            options.forEach(option => {
                if (option.value !== '') {
                    const button = document.createElement('button');
                    button.type = 'button';
                    button.className = 'btn btn-outline-primary btn-sm';
                    button.textContent = option.textContent;
                    button.style.whiteSpace = 'normal';
                    button.setAttribute('data-value', option.value);
                    button.addEventListener('click', function () {
                        buttonContainer.querySelectorAll('.btn').forEach(btn => btn.classList.remove('btn-primary'));
                        button.classList.add('btn-primary');
                        select.value = button.getAttribute('data-value');
                    });
                    buttonContainer.appendChild(button);
                }
            });
        }
        select.style.display = 'none';
        parentDiv.appendChild(buttonContainer);
    });
    applyPrefillAndSkip();
    console.log('Made it to the end of the script');
</script>